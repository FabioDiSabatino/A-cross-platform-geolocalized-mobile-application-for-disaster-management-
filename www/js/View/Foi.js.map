{"version":3,"file":"Foi.js","sourceRoot":"","sources":["../../../scripts/View/Foi.ts"],"names":[],"mappings":"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","sourcesContent":["namespace View {\r\n    \"use strict\";\r\n    export class Foi implements IPage {\r\n        private compiledListTemplate: HandlebarsTemplateDelegate;\r\n        /**\r\n         * Specifies current view:\r\n         * 0 = List\r\n         * 1 = Map\r\n         */\r\n        private currentView: number;\r\n\r\n        public constructor() {\r\n            let templateGetter = new XMLHttpRequest();\r\n            templateGetter.open(\"GET\", \"templates/foi-list.tmpl\", false);\r\n            templateGetter.send();\r\n            this.compiledListTemplate = Handlebars.compile(templateGetter.responseText);\r\n        }\r\n\r\n        public initialize() {\r\n            $(document).on(\"pagecontainerchange\", (event: JQueryEventObject, pages: any) => {\r\n                if (pages.toPage.children().prop(\"id\") !== \"foi\") {\r\n                    return;\r\n                }\r\n                if (main.FoiList.CurrentSorting !== null) {\r\n                    switch (main.FoiList.CurrentSorting) {\r\n                        case foiSorting.latestUpdate: document.getElementById(\"foi-latest\").classList.add(\"active\"); break;\r\n                        case foiSorting.nearest: document.getElementById(\"foi-nearest\").classList.add(\"active\"); break;\r\n                        case foiSorting.seriousness: document.getElementById(\"foi-seriousness\").classList.add(\"active\"); break;\r\n                    }\r\n                }\r\n                document.getElementById(\"back-from-foi\").addEventListener(main.UXEvent, () => {\r\n                    if (typeof main.CHome !== \"undefined\") {\r\n                        main.CHome.stop();\r\n                    }\r\n                    main.navigateBack();\r\n                }, false);\r\n                this.renderList(true);\r\n                document.getElementById(\"foi-popup\").addEventListener(main.UXEvent, () => this.showPopover());\r\n                document.getElementById(\"foi-latest\").addEventListener(main.UXEvent, () => {\r\n                    this.sort(foiSorting.latestUpdate);\r\n                    $(\"#popupMenu\").popup(\"close\");\r\n                    this.renderList(true);\r\n                }, true);\r\n                document.getElementById(\"foi-nearest\").addEventListener(main.UXEvent, () => {\r\n                    this.sort(foiSorting.nearest);\r\n                    $(\"#popupMenu\").popup(\"close\");\r\n                    this.renderList(true);\r\n                }, true);\r\n                document.getElementById(\"foi-seriousness\").addEventListener(main.UXEvent, () => {\r\n                    this.sort(foiSorting.seriousness);\r\n                    $(\"#popupMenu\").popup(\"close\");\r\n                    this.renderList(true);\r\n                }, true);\r\n                document.getElementById(\"lista-foi\").addEventListener(main.UXEvent, () => this.renderList(), false);\r\n                document.getElementById(\"mappa-foi\").addEventListener(main.UXEvent, () => this.renderMap(), false);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Sorts element in list or centers map on first in\r\n         * sorting FOI.\r\n         * @param sortBy Sorting tipology.\r\n         * Available choises:\r\n         * 0 -> Sort by latest update\r\n         * 1 -> Sort by nearest\r\n         * 2 -> Sort by seriousness\r\n         */\r\n        private sort(sortBy: foiSorting) {\r\n            switch (sortBy) {\r\n                case foiSorting.latestUpdate: main.FoiList.sortByLatestUpdate(); break;\r\n                case foiSorting.nearest: main.FoiList.sortByNearest(); break;\r\n                case foiSorting.seriousness: main.FoiList.sortBySeriousness(); break;\r\n            }\r\n            var checks = [document.getElementById(\"check-latest\"),\r\n                document.getElementById(\"check-nearest\"),\r\n                document.getElementById(\"check-seriousness\")];\r\n            for (let i = 0; i < checks.length; ++i) {\r\n                if (i === sortBy) {\r\n                    checks[i].classList.add(\"active\");\r\n                } else {\r\n                    checks[i].classList.remove(\"active\");\r\n                }\r\n            }\r\n            // mi trovo nella schermata a lista\r\n            if (document.getElementById(\"filters-title\").classList.contains(\"order-by\")) {\r\n                this.renderList();\r\n            } else { // mi trovo nella schermata a mappa\r\n                main.CHome.centerView(main.FoiList[0]);\r\n            }\r\n        }\r\n\r\n        private showPopover() {\r\n            let options: PopupOptions = {\r\n                \"positionTo\": \"#foi-popup\",\r\n                \"overlayTheme\": \"a\",\r\n                \"history\": false,\r\n                \"transition\": \"pop\"\r\n\r\n            };\r\n            let popupElement = $(\"#popupMenu\");\r\n            popupElement.popup(options);\r\n            popupElement.popup(\"open\");\r\n        }\r\n\r\n        /**\r\n         * Renders FOI's list.\r\n         * @param forced Forces this method to execute even if not from map view\r\n         */\r\n        private renderList(forced?: boolean) {\r\n            if (typeof forced !== \"undefined\" && !forced) {\r\n                if (this.currentView === 0) {\r\n                    return;\r\n                } else if (this.currentView === 1) {\r\n                    main.CHome.stop();\r\n                }\r\n            }\r\n            var list = document.createElement(\"ul\");\r\n            list.id = \"poi-list\";\r\n            list.className = \"table-view table-stato\";\r\n            for (let i = 0; i < main.FoiList.length; ++i) {\r\n                list.innerHTML += this.compiledListTemplate(main.FoiList[i]);\r\n            }\r\n            document.getElementById(\"content-foi\").innerHTML = list.outerHTML;\r\n            let filtersTitle = document.getElementById(\"filters-title\");\r\n            filtersTitle.textContent = \"Order by:\";\r\n            filtersTitle.classList.add(\"order-by\");\r\n            this.currentView = 0;\r\n        }\r\n\r\n        private renderMap() {\r\n            if (this.currentView === 1) {\r\n                return;\r\n            }\r\n            let templateGetter = new XMLHttpRequest();\r\n            templateGetter.open(\"GET\", \"templates/foi-map.html\", false);\r\n            templateGetter.send();\r\n            document.getElementById(\"content-foi\").innerHTML = templateGetter.responseText;\r\n            main.CHome = new Controller.Home();\r\n            main.VHome = new View.Home();\r\n            main.VHome.clearMap();\r\n            main.VHome.noCenterMe();\r\n            main.VHome.addFoi(main.FoiList);\r\n            main.CHome.Map.on(\"load\", () => {\r\n                main.CHome.centerView(main.FoiList[0]);\r\n            });\r\n            let filtersTitle = document.getElementById(\"filters-title\");\r\n            filtersTitle.textContent = \"Center view on:\";\r\n            filtersTitle.classList.remove(\"order-by\");\r\n            this.currentView = 1;\r\n        }\r\n    }\r\n}"]}