{"version":3,"file":"Foi.js","sourceRoot":"","sources":["../../../scripts/Entity/Foi.ts"],"names":[],"mappings":"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","sourcesContent":["ï»¿enum statuses {\r\n    Fine,\r\n    SlightlyWounded,\r\n    Injuried,\r\n    Trapped,\r\n    TrappedAndInjuried\r\n}\r\nenum deviceStatuses {\r\n    Powered,\r\n    Online,\r\n    Offline\r\n}\r\nnamespace Entity {\r\n    \"use strict\";\r\n    export class Foi implements ILocalizable {\r\n        private id: number;\r\n        private name: string;\r\n        private picture: string;\r\n        private status: statuses;\r\n        private latestUpdate: Date;\r\n        private distance: number;\r\n        private position: L.LatLng;\r\n        private cell: L.LatLng;\r\n        private deviceStatus: number;\r\n        private lastSeen: Date;\r\n\r\n\r\n        public constructor(id: number, status: statuses, latestUpdate: number,\r\n            distance: number, position: number[], cell: number[],\r\n            deviceStatus: number, lastSeen: number = Date.now()) {\r\n            this.id = id;\r\n            this.status = status;\r\n            this.latestUpdate = new Date(latestUpdate * 1000);\r\n            this.distance = distance;\r\n            this.position = new L.LatLng(position[0], position[1]);\r\n            this.cell = new L.LatLng(cell[0], cell[1]);\r\n            this.deviceStatus = deviceStatus;\r\n            this.lastSeen = new Date(lastSeen * 1000);\r\n            this.getNameAndPictureByNumber();\r\n\r\n        }\r\n\r\n        public get ID(): number {\r\n            return this.id;\r\n        }\r\n        public get Name(): string {\r\n            return this.name;\r\n        }\r\n        public get Picture(): string {\r\n            return this.picture;\r\n        }\r\n        public get StatusCode(): statuses {\r\n            return this.status;\r\n        }\r\n        public set StatusCode(statusCode: statuses) {\r\n            this.status = statusCode;\r\n        }\r\n        public get LatestUpdate(): Date {\r\n            return this.latestUpdate;\r\n        }\r\n        public set LatestUpdate(updateDate: Date) {\r\n            if (this.latestUpdate < updateDate) {\r\n                this.latestUpdate = updateDate;\r\n            }\r\n        }\r\n        public get Distance(): number {\r\n            return this.distance;\r\n        }\r\n        public get Position(): L.LatLng {\r\n            return this.position;\r\n        }\r\n        public get Cell(): L.LatLng {\r\n            return this.cell;\r\n        }\r\n        public get DeviceStatus(): number {\r\n            return this.deviceStatus;\r\n        }\r\n        public set ReportNumber(reports: number) {\r\n            this.deviceStatus = reports;\r\n        }\r\n\r\n        /**\r\n         * Tries to fetch FOI Name and Picture from contacts\r\n         * starting from its phone number.\r\n         * I know it's crappy, but it's best implementation\r\n         * I could think with cordova tools.\r\n         */\r\n        private getNameAndPictureByNumber() {\r\n            let found = false;\r\n            let stringId = this.id.toString();\r\n            for (let i = 0; i < Foundation.ContactGetter.contacts.length && !found; ++i) {\r\n                for (let j = 0; j < Foundation.ContactGetter.contacts[i].phoneNumbers.length && !found; ++j) {\r\n                    let phoneNumber: string = Foundation.ContactGetter.contacts[i].phoneNumbers[j].value.replace(/\\s+/g, \"\");\r\n                    let within: number = phoneNumber.indexOf(stringId);\r\n                    // checks that the number in address book is the one\r\n                    // received (with or without country code)\r\n                    if (within !== -1 && within < 4) {\r\n                        found = true;\r\n                        this.name = Foundation.ContactGetter.contacts[i].displayName;\r\n                        // contacts has a picture\r\n                        if (Foundation.ContactGetter.contacts[i].photos !== null) {\r\n                            this.picture = Foundation.ContactGetter.contacts[i].photos[0].value;\r\n                        } else {\r\n                            // default image!\r\n                            this.picture = \"img/persone.png\";\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // whoa! You added a FOI whose number isn't on your address book!\r\n            if (!found) {\r\n                this.name = \"+\" + this.id;\r\n                // default image!\r\n                this.picture = \"img/persone.png\";\r\n            }\r\n        }\r\n    }\r\n}"]}