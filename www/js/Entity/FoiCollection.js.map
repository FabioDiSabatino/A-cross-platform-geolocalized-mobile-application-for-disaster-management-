{"version":3,"file":"FoiCollection.js","sourceRoot":"","sources":["../../../scripts/Entity/FoiCollection.ts"],"names":[],"mappings":"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","sourcesContent":["﻿enum foiSorting {\r\n    latestUpdate,\r\n    nearest,\r\n    seriousness\r\n}\r\nnamespace Entity {\r\n    \"use strict\";\r\n    export class FoiCollection extends Array<Foi> {\r\n        private currentSorting: foiSorting = null;\r\n        private isComplete: boolean;\r\n        public get IsComplete(): boolean {\r\n            return this.isComplete;\r\n        }\r\n\r\n        public get CurrentSorting(): foiSorting {\r\n            return this.currentSorting;\r\n        }\r\n\r\n        public constructor(length?: number) {\r\n            super(length);\r\n            this.isComplete = false;\r\n            document.addEventListener(\"foiCreated\", () => {\r\n                this.isComplete = true;\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Returns most serious FOI.\r\n         * If more than one is found, returns the first one.\r\n         */\r\n        public mostSerious(): Foi {\r\n            var mostSeriousIndex = 0;\r\n            for (let i = 0; i < this.length; ++i) {\r\n                if (this[i].StatusCode === statuses.TrappedAndInjuried) {\r\n                    return this[i];\r\n                }\r\n                if (this[i].StatusCode > this[mostSeriousIndex].StatusCode) {\r\n                    mostSeriousIndex = i;\r\n                }\r\n            }\r\n            return this[mostSeriousIndex];\r\n        }\r\n\r\n        /**\r\n         * Ordinamento dei FOI in base alla gravità.\r\n         */\r\n        public sortBySeriousness() {\r\n            this.currentSorting = foiSorting.seriousness;\r\n            this.sort((a: Foi, b: Foi) => {\r\n                return b.StatusCode - a.StatusCode;\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Riordino dei FOI in base alla distanza\r\n         */\r\n        public sortByNearest() {\r\n            this.currentSorting = foiSorting.nearest;\r\n            this.sort((a: Foi, b: Foi) => {\r\n                return a.Distance - b.Distance;\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Riordino dei FOI sulla base dell'ultimo update.\r\n         */\r\n        public sortByLatestUpdate() {\r\n            this.currentSorting = foiSorting.latestUpdate;\r\n            this.sort((a: Foi, b: Foi) => {\r\n                return a.LatestUpdate.getTime() - b.LatestUpdate.getTime();\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Crea una collezione di FOI a partire dal JSON ricevuto dal server\r\n         * @param foiJSON JSON ricevuto dal server\r\n         */\r\n        public static parseJSON(foiJSON: Array<any>): FoiCollection {\r\n            var returns = new FoiCollection(foiJSON.length);\r\n            for (let i = 0; i < foiJSON.length; ++i) {\r\n                if (foiJSON[i].device === deviceStatuses.Online) {\r\n                    returns.push(new Foi(foiJSON[i].id, foiJSON[i].status,\r\n                        foiJSON[i].latestUpdate, foiJSON[i].distance,\r\n                        foiJSON[i].position.zero, foiJSON[i].position.cell, foiJSON[i].device));\r\n                }\r\n                returns.push(new Foi(foiJSON[i].id, foiJSON[i].status,\r\n                    foiJSON[i].latestUpdate, foiJSON[i].distance, foiJSON[i].position.zero,\r\n                    foiJSON[i].position.cell, foiJSON[i].device, foiJSON[i].lastSeen));\r\n            }\r\n            return returns;\r\n        }\r\n    }\r\n}"]}