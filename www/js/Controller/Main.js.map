{"version":3,"file":"Main.js","sourceRoot":"","sources":["../../../scripts/Controller/Main.ts"],"names":[],"mappings":"AAEA,IAAU,UAAU,CAkKnB;AAlKD,WAAU,UAAU,EAAC,CAAC;IAClB,YAAY,CAAC;IACb;QA4CI;YA5CJ,iBA+JC;YAhHO,QAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE;gBACrC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,KAAK,KAAK,IAAI,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;oBAClE,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC,YAAY,CAAC,SAAS,EAChE,qEAAqE,CAAC,CAAC;gBAC/E,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC,YAAY,CAAC,SAAS,EAChE,+GAA+G,CAAC,CAAC;gBACzH,CAAC;YACL,CAAC,EAAE,KAAK,CAAC,CAAC;YACV,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;YACpB,IAAI,CAAC,QAAQ,GAAG,IAAI,sBAAW,EAAE,CAAC;YAElC,QAAQ,CAAC,gBAAgB,CAAC,YAAY,EAAE;gBAEpC,EAAE,CAAC,CAAC,KAAI,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;oBAC9B,KAAI,CAAC,YAAY,EAAE,CAAC;gBACxB,CAAC;YACL,CAAC,EAAE,KAAK,CAAC,CAAC;YACV,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,IAAI,CAAC,eAAe,EAAE,CAAC;YACvB,IAAI,aAAa,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;YAChF,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE,aAAa,CAAC,CAAC;YAGjD,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,UAAC,OAAc;gBACjC,UAAU,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC;gBACtC,QAAQ,CAAC,gBAAgB,CAAC,gBAAgB,EAAE;oBACxC,KAAI,CAAC,OAAO,GAAG,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;oBACvD,IAAI,OAAO,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;oBAC5C,OAAO,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;oBAC5C,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;oBAChC,IAAI,IAAI,GAAQ,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;oBACtD,IAAI,CAAC,eAAe,EAAE,CAAC;gBAC3B,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;YACH,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,UAAC,OAAc;gBACjC,KAAI,CAAC,OAAO,GAAG,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;YAC3D,CAAC,CAAC,CAAC;QAEP,CAAC;QApFD,sBAAW,yBAAO;iBAAlB;gBACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACxB,CAAC;;;WAAA;QAED,sBAAW,yBAAO;iBAAlB;gBACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACxB,CAAC;;;WAAA;QAGD,sBAAW,8BAAY;iBAAvB;gBACI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACzB,CAAC;;;WAAA;QAED,sBAAW,uBAAK;iBAAhB;gBACI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;YACtB,CAAC;iBACD,UAAiB,KAAsB;gBACnC,EAAE,CAAC,CAAC,OAAO,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,CAAC,CAAC;oBACpC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;gBAC5B,CAAC;gBACD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACvB,CAAC;;;WANA;QAQD,sBAAW,uBAAK;iBAAhB;gBACI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;YACtB,CAAC;iBACD,UAAiB,KAAgB;gBAC7B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACvB,CAAC;;;WAHA;QAQD,sBAAW,yBAAO;iBAAlB;gBACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACxB,CAAC;;;WAAA;QAwDM,yBAAU,GAAjB,UAAkB,IAAY,EAAE,WAAuB;YAGnD,IAAI,mBAAmB,GAAQ,QAAQ,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;YAC1E,IAAI,WAAW,GAAW,mBAAmB,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC;YAC1F,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAEzE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YAC1F,WAAW,CAAC,UAAU,EAAE,CAAC;QAC7B,CAAC;QAKM,2BAAY,GAAnB;YACI,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;QAC9G,CAAC;QAEO,yBAAU,GAAlB;YACI,EAAE,CAAC,CAAC,cAAc,IAAI,MAAM,CAAC,CAAC,CAAC;gBAE3B,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,eAAe,IAAI,MAAM,CAAC,CAAC,CAAC;gBAEnC,IAAI,CAAC,OAAO,GAAG,eAAe,CAAC;YACnC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;YAC3B,CAAC;QACL,CAAC;QAMO,8BAAe,GAAvB;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,YAAY,CAAC,CAAC,CAAC;gBAChC,IAAI,WAAiB,CAAC;gBACtB,IAAI,SAAe,CAAC;gBACpB,IAAI,QAAe,CAAC;gBACpB,QAAQ,CAAC,gBAAgB,CAAC,YAAY,EAAE,UAAC,KAAiB;oBACtD,WAAS,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;oBACjC,QAAM,GAAG,KAAK,CAAC;gBACnB,CAAC,EAAE,KAAK,CAAC,CAAC;gBAEV,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAC,KAAiB;oBACrD,QAAM,GAAG,IAAI,CAAC;gBAClB,CAAC,EAAE,KAAK,CAAC,CAAC;gBAEV,QAAQ,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAC,KAAiB;oBACpD,SAAO,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;oBAC/B,EAAE,CAAC,CAAC,CAAC,QAAM,IAAI,CAAC,SAAO,GAAG,WAAS,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;wBAC9C,IAAI,OAAO,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;wBAC5C,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;wBACzC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;oBACpC,CAAC;gBACL,CAAC,EAAE,KAAK,CAAC,CAAC;YACd,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAC,CAAa;oBACjD,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;wBAChB,IAAI,OAAO,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;wBAC5C,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;wBACzC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;oBACpC,CAAC;gBACL,CAAC,CAAC,CAAC;YACP,CAAC;QACL,CAAC;QACL,WAAC;IAAD,CAAC,AA/JD,IA+JC;IA/JY,eAAI,OA+JhB,CAAA;AACL,CAAC,EAlKS,UAAU,KAAV,UAAU,QAkKnB;AAGD,QAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE;IACrC,IAAI,GAAG,IAAI,UAAU,CAAC,IAAI,EAAE,CAAC;AACjC,CAAC,EAAE,KAAK,CAAC,CAAC","sourcesContent":["ï»¿declare var main: Controller.Main;\r\n\r\nnamespace Controller {\r\n    \"use strict\";\r\n    export class Main {\r\n        private foiList: Entity.FoiCollection;\r\n        public get FoiList(): Entity.FoiCollection {\r\n            return this.foiList;\r\n        }\r\n        private poiList: Entity.PoiCollection;\r\n        public get PoiList(): Entity.PoiCollection {\r\n            return this.poiList;\r\n        }\r\n        private uxevent: string;\r\n        private handlers: PageHandler;\r\n        public get PageHandlers(): PageHandler {\r\n            return this.handlers;\r\n        }\r\n        private chome: Controller.Home;\r\n        public get CHome(): Controller.Home {\r\n            return this.chome;\r\n        }\r\n        public set CHome(chome: Controller.Home) {\r\n            if (typeof this.chome !== \"undefined\") {\r\n                this.chome.Map.remove();\r\n            }\r\n            this.chome = chome;\r\n        }\r\n        private vhome: View.Home;\r\n        public get VHome(): View.Home {\r\n            return this.vhome;\r\n        }\r\n        public set VHome(vhome: View.Home) {\r\n            this.vhome = vhome;\r\n        }\r\n\r\n        /**\r\n         * Get current User Navigation event (click, touchstart, MSPointerDown)\r\n         */\r\n        public get UXEvent() {\r\n            return this.uxevent;\r\n        }\r\n\r\n        /**\r\n         * A stack containing all navigation history\r\n         */\r\n        private pageStack: string[];\r\n\r\n        public constructor() {\r\n            // WARNING: for iOS 7, remove the width=device-width and height=device-height attributes.\r\n            // See https://issues.apache.org/jira/browse/CB-4323\r\n            document.addEventListener(\"deviceready\", () => {\r\n                if (device.platform === \"iOS\" && parseFloat(device.version) === 7.0) {\r\n                    document.querySelector(\"meta[name=viewport]\").setAttribute(\"content\",\r\n                        \"user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1\");\r\n                } else {\r\n                    document.querySelector(\"meta[name=viewport]\").setAttribute(\"content\",\r\n                        \"user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1, width=device-width, height=device-height\");\r\n                }\r\n            }, false);\r\n            this.pageStack = [];\r\n            this.handlers = new PageHandler();\r\n            // comportamento alla pressione del tasto indietro\r\n            document.addEventListener(\"backbutton\", () => {\r\n                // we are NOT on index page.\r\n                if (this.pageStack.length !== 1) {\r\n                    this.navigateBack();\r\n                }\r\n            }, false);\r\n            this.setUXEvent();\r\n            this.setTapHoldEvent();\r\n            let dashboardView = this.handlers.addHandler(\"dashboard\", new View.Dashboard());\r\n            this.navigateTo(\"dashboard.html\", dashboardView);\r\n            // ========================================================\r\n            // soluzioni temporanee\r\n            $.getJSON(\"foi.json\", (jsonFoi: any[]) => {\r\n                Foundation.ContactGetter.initialize();\r\n                document.addEventListener(\"contactsLoaded\", () => {\r\n                    this.foiList = Entity.FoiCollection.parseJSON(jsonFoi);\r\n                    let created = document.createEvent(\"Event\");\r\n                    created.initEvent(\"foiCreated\", true, true);\r\n                    document.dispatchEvent(created);\r\n                    let dash: any = this.handlers.getHandler(\"dashboard\");\r\n                    dash.updateFoiBanner();\r\n                });\r\n            });\r\n            $.getJSON(\"poi.json\", (jsonPoi: any[]) => {\r\n                this.poiList = Entity.PoiCollection.parseJSON(jsonPoi);\r\n            });\r\n            // ========================================================\r\n        }\r\n\r\n        /**\r\n         * Navigate no a specific page.\r\n         * @param page Page file name (.html has to be provided).\r\n         * @param pageHandler PageHandler with all specific methods.\r\n         */\r\n        public navigateTo(page: string, pageHandler: View.IPage) {\r\n            // add current page to stack ===============================================================\r\n            // classes and data-url are defined by jQuery Mobile\r\n            var currentlyShownPages: any = document.getElementsByClassName(\"ui-page\");\r\n            var absoluteUrl: string = currentlyShownPages[currentlyShownPages.length - 1].dataset.url;\r\n            this.pageStack.push(absoluteUrl.slice(absoluteUrl.lastIndexOf(\"/\") + 1));\r\n            // then navigates to new page ==============================================================\r\n            $.mobile.pageContainer.pagecontainer(\"change\", page, { changeHash: false, role: \"page\" });\r\n            pageHandler.initialize();\r\n        }\r\n\r\n        /**\r\n         * Navigates one page back.\r\n         */\r\n        public navigateBack() {\r\n            $.mobile.pageContainer.pagecontainer(\"change\", main.pageStack.pop(), { changeHash: false, role: \"page\" });\r\n        }\r\n\r\n        private setUXEvent() {\r\n            if (\"ontouchstart\" in window) {\r\n                // iOS, Android & W10\r\n                this.uxevent = \"touchstart\";\r\n            } else if (\"MSPointerDown\" in window) {\r\n                // windows phone 8\r\n                this.uxevent = \"MSPointerDown\";\r\n            } else {\r\n                this.uxevent = \"click\";\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Cretes Tap & Hold Event and fires it when catched.\r\n         * If on desktop, tap-hold is replaced with right-click.\r\n         */\r\n        private setTapHoldEvent() {\r\n            if (this.uxevent === \"touchstart\") {\r\n                let startTime: number;\r\n                let endTime: number;\r\n                let gbMove: boolean;\r\n                document.addEventListener(\"touchstart\", (event: TouchEvent) => {\r\n                    startTime = new Date().getTime();\r\n                    gbMove = false;\r\n                }, false);\r\n\r\n                document.addEventListener(\"touchmove\", (event: TouchEvent) => {\r\n                    gbMove = true;\r\n                }, false);\r\n\r\n                document.addEventListener(\"touchend\", (event: TouchEvent) => {\r\n                    endTime = new Date().getTime();\r\n                    if (!gbMove && (endTime - startTime) / 1000 > 2) {\r\n                        let taphold = document.createEvent(\"Event\");\r\n                        taphold.initEvent(\"taphold\", true, true);\r\n                        document.dispatchEvent(taphold);\r\n                    }\r\n                }, false);\r\n            } else {\r\n                document.addEventListener(\"mousedown\", (e: MouseEvent) => {\r\n                    if (e.which === 3) {\r\n                        let taphold = document.createEvent(\"Event\");\r\n                        taphold.initEvent(\"taphold\", true, true);\r\n                        document.dispatchEvent(taphold);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\ndocument.addEventListener(\"deviceready\", () => {\r\n    main = new Controller.Main();\r\n}, false);"]}