{"version":3,"file":"Cmap.js","sourceRoot":"","sources":["../../../scripts/Controller/Cmap.ts"],"names":[],"mappings":"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","sourcesContent":["namespace Controller {\r\n    \"use strict\";\r\n    export class Map {\r\n        private map: L.Map;\r\n        get Map(): L.Map {\r\n            return this.map;\r\n        }\r\n        private offlineLayer: OfflineLayer;\r\n\r\n        public constructor() {\r\n            this.map = L.map(\"map\");\r\n            this.offlineLayer = new OfflineLayer(\"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n                {\r\n                    attribution: \"&copy; <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors Tiles Â© HOT\",\r\n                    onReady: () => {\r\n                        this.map.addLayer(this.offlineLayer);\r\n                        this.map.locate({\r\n                            watch: true,\r\n                            enableHighAccuracy: true,\r\n                            timeout: 500,\r\n                        });\r\n                    },\r\n                    onError: () => { console.log(\"errore db\"); },\r\n                    dbOption: \"IndexedDB\"\r\n                });\r\n\r\n            let onLocationFound = (e: L.LeafletLocationEvent) => {\r\n                console.log(\"localizzato!!\");\r\n                main.VHome.addMe(e.latlng);\r\n                var cell_data = Grid.calcCell(e.latlng);\r\n                console.log(\"dati griglia:\");\r\n                console.log(cell_data);\r\n                Foundation.Database.savePosition(cell_data);\r\n            };\r\n\r\n            let onLocationError = () => {\r\n                this.map.setView(L.latLng(42.36, 13.412), 12);\r\n            };\r\n\r\n            this.map.on(\"locationfound\", onLocationFound);\r\n            this.map.on(\"locationerror\", onLocationError);\r\n\r\n            $(\"#button_grid\").on(main.UXEvent, () => {\r\n                alert(\"disegno la griglia...\");\r\n            });\r\n\r\n            $(\"#button_save\").on(main.UXEvent, () => {\r\n                this.saveMap();\r\n            });\r\n\r\n        }\r\n\r\n        public saveMap() {\r\n            this.offlineLayer.saveTiles(17, () => { console.log(\"salvataggio in corso...\"); },\r\n                () => { console.log(\"salvataggio completato!\"); },\r\n                () => { console.log(\"errore!\"); });\r\n        }\r\n\r\n        public stopMap() {\r\n            this.map.stopLocate();\r\n            this.map.off(\"load\");\r\n            main.VHome.stopLocate();\r\n        }\r\n\r\n        public centerView(coordinates: L.LatLng) {\r\n            this.map.setView(coordinates, 18);\r\n        }\r\n\r\n        public tapHold() {\r\n            this.map.on(\"taphold\", (e: L.LeafletLocationEvent) => {\r\n                main.VHome.tapHold(e.latlng);\r\n            });\r\n        }\r\n    }\r\n}"]}